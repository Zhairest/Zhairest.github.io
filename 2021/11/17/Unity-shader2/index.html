<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Unity," />










<meta name="description" content="概括讲述了小部分的光照模型，如Lambert和phong模型，并在shader中实现。">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity_shader2_各类光照模型">
<meta property="og:url" content="http://example.com/2021/11/17/Unity-shader2/index.html">
<meta property="og:site_name" content="旋转公寓的阁楼">
<meta property="og:description" content="概括讲述了小部分的光照模型，如Lambert和phong模型，并在shader中实现。">
<meta property="og:locale">
<meta property="og:image" content="http://example.com/image-20211117201334581.png!%5Bim20211117201538527%5D(image-20211117201538527.png">
<meta property="og:image" content="http://example.com/2021/11/17/Unity-shader2/image-20211117201523639.png">
<meta property="og:image" content="http://example.com/2021/11/17/Unity-shader2/image-20211117204323435.png">
<meta property="og:image" content="http://example.com/2021/11/17/Unity-shader2/image-20211118181116607.png">
<meta property="og:image" content="http://example.com/2021/11/17/Unity-shader2/image-20211118181228268.png">
<meta property="og:image" content="http://example.com/2021/11/17/Unity-shader2/92f4f5f9b284a56a0ee6e7f7235fb985.png">
<meta property="og:image" content="http://example.com/2021/11/17/Unity-shader2/6a29e48cee2d8eee77eeddb6b49f22aa-16372315719662.png">
<meta property="og:image" content="http://example.com/2021/11/17/Unity-shader2/image-20211118193048793.png">
<meta property="article:published_time" content="2021-11-17T09:03:29.000Z">
<meta property="article:modified_time" content="2021-11-21T04:44:15.129Z">
<meta property="article:author" content="Zhairest">
<meta property="article:tag" content="Unity">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/image-20211117201334581.png!%5Bim20211117201538527%5D(image-20211117201538527.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/2021/11/17/Unity-shader2/"/>





  <title>Unity_shader2_各类光照模型 | 旋转公寓的阁楼</title>
  








<meta name="generator" content="Hexo 5.4.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">旋转公寓的阁楼</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">储物间</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/11/17/Unity-shader2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="旋转公寓的阁楼">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Unity_shader2_各类光照模型</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-11-17T17:03:29+08:00">
                2021-11-17
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">更新于&#58;</span>
              
              <time title="更新于" itemprop="dateModified" datetime="2021-11-21T12:44:15+08:00">
                2021-11-21
              </time>
            
          </span>

          

          
            
          

          
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4.2k
                </span>
              

              

              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>概括讲述了小部分的光照模型，如Lambert和phong模型，并在shader中实现。</p>
<span id="more"></span>

<h1 id="shader中的光照模型"><a href="#shader中的光照模型" class="headerlink" title="shader中的光照模型"></a>shader中的光照模型</h1><p>学到这一章，又为之前图形学的浑水摸鱼而感到羞耻我(＠_＠;)</p>
<h2 id="Lambert光照模型"><a href="#Lambert光照模型" class="headerlink" title="Lambert光照模型"></a>Lambert光照模型</h2><p>​    光射到粗糙的物体，产生漫反射（diffuse），满足Lambert定理：反射光线的强度与表面法线和光影方向之间的夹角成正比。即光线垂直物体表面时，漫反射强度最大。</p>
<p>其计算公式为：<br>$$<br>C_diffuse =(C_light<em>M_diffuse)saturate(n·l)<br>$$<br>​                        C物体的漫反射颜色=（C入射光线的颜色</em>M物体材质的漫反射颜色）将点积取[0，1]之间（物体的表面法线 -点积- 物体指向灯光的方向）</p>
<h3 id="那如何在shader里获得灯光呢"><a href="#那如何在shader里获得灯光呢" class="headerlink" title="那如何在shader里获得灯光呢"></a>那如何在shader里获得灯光呢</h3><p>​    Edit&gt;Project Setting&gt;Graphics 中发现已经被设置是前向渲染了</p>
<p>​    这下子可以使用的灯光属性变量有：_LightColor0     fixed4     灯光的颜色乘上亮度</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Hidden/<span class="number">1</span>_Lambert&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainColor(&quot;Main Color&quot;,Color)=(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#pragma vertex vert</span></span><br><span class="line">            <span class="meta">#pragma fragment frag</span></span><br><span class="line">            <span class="meta">#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line">            <span class="meta">#include &quot;UnityLightingCommon.cginc&quot;</span></span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                fixed4 dif : COLOR0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            fixed4 _MainColor;</span><br><span class="line"></span><br><span class="line">            v2f vert (appdata_base v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos =UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//法线向量</span></span><br><span class="line">                float3 n=UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                n=<span class="built_in">normalize</span>(n);</span><br><span class="line">                <span class="comment">//灯光方向向量</span></span><br><span class="line">                fixed3 l=<span class="built_in">normalize</span>(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                <span class="comment">//按照公式计算漫反射s</span></span><br><span class="line">                fixed ndotl =<span class="built_in">dot</span>(n,l);<span class="comment">//点积</span></span><br><span class="line">                o.dif =_LightColor0*_MainColor*saturate(ndotl);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag (v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> i.dif;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  //法线向量<br>                float3 n=UnityObjectToWorldNormal(v.normal);<br>                n=normalize(n);</p>
<p>​    计算光照时要确保在同一空间，而法线向量在模型空间，灯光方向向量在世界空间，因此要转化，并且进行标准化。<img src="/image-20211117201334581.png!%5Bim20211117201538527%5D(image-20211117201538527.png" alt="image-20211117201334581"></p>
<hr>
<h2 id="Half-Lambert光照模型"><a href="#Half-Lambert光照模型" class="headerlink" title="Half-Lambert光照模型"></a>Half-Lambert光照模型</h2><p>​    前者Lambert光照能看到，物体的背面明显过黑，只能再加灯，但不利于性能的优化。故有half出现。</p>
<p>其计算公式为：<br>$$<br>C_diffuse =(C_light<em>M_diffuse)[0.5</em>(n·l)+0.5]<br>$$<br>​    如此可以看到是先乘0.5将区间缩小至[-0.5,0.5]，然后再加上去，使得物体光照强度从最亮逐渐过渡到最暗。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//仅改动vertex_shader部分</span></span><br><span class="line">            v2f vert (appdata_base v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos =UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//法线向量</span></span><br><span class="line">                float3 n=UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                n=<span class="built_in">normalize</span>(n);</span><br><span class="line">                <span class="comment">//灯光方向向量</span></span><br><span class="line">                fixed3 l=<span class="built_in">normalize</span>(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                <span class="comment">//按照公式计算漫反射s</span></span><br><span class="line">                fixed ndotl =<span class="built_in">dot</span>(n,l);</span><br><span class="line">                o.dif =_LightColor0*_MainColor*(<span class="number">0.5</span>*ndotl+<span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2021/11/17/Unity-shader2/image-20211117201523639.png" alt="image-20211117201523639"></p>
<hr>
<h2 id="Phong光照模型"><a href="#Phong光照模型" class="headerlink" title="Phong光照模型"></a>Phong光照模型</h2><p>​    Lambert能模拟粗糙表面的光照，但是还有很多光滑物体，因此引入镜面反射的光照模型-Phong（印象中好像片元分的够细，俩者效果其实相差无几）</p>
<p>（Phong，越南出生的美国科学家）</p>
<p>其计算公式为：<br>$$<br>SurfaceColor=C_Ambient+C_Diffuse+C_Specular<br>$$<br>即                                环境光+漫反射+镜面反射</p>
<p>其中镜面反射的公式为：<br>$$<br>C_Specular=(C_light·M_specular)saturate(v·r)^Mshininess<br>$$<br>即                                镜面反射光=（灯光亮度·物体材质镜面反射亮度）将范围截到[0,1] (视角方向·光线的发射方向)^物体材质的光泽度</p>
<h3 id="那如何在shader里获得环境光呢"><a href="#那如何在shader里获得环境光呢" class="headerlink" title="那如何在shader里获得环境光呢"></a>那如何在shader里获得环境光呢</h3><p>​    Window-Rendering-LightingSetting中environmentLight选择Gradient</p>
<p>​    即可使用：unity_AmbientSky 环境类型的sky color</p>
<p>​        unity_AmbientEquator</p>
<p>​        unity_AmbientGround</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Hidden/<span class="number">3</span>_Phong&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainColor(&quot;Main Color&quot;,Color)=(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">        _SpecularColor(&quot;Specular Color&quot;,Color)=(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>)    <span class="comment">//控制高光颜色</span></span><br><span class="line">        _Shininess(&quot;Shininess&quot;,Range(<span class="number">1</span>,<span class="number">100</span>))=<span class="number">1</span>      <span class="comment">//控制光泽度</span></span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#pragma vertex vert</span></span><br><span class="line">            <span class="meta">#pragma fragment frag</span></span><br><span class="line">            <span class="meta">#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line">            <span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                fixed4 color : COLOR0;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            fixed4 _MainColor;</span><br><span class="line">            fixed4 _SpecularColor;</span><br><span class="line">            half _Shininess;</span><br><span class="line"></span><br><span class="line">            v2f vert (appdata_base v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos =UnityObjectToClipPos(v.vertex);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//计算公式中各个变量</span></span><br><span class="line">                <span class="comment">//法线向量</span></span><br><span class="line">                float3 n=UnityObjectToWorldNormal(v.normal);</span><br><span class="line">                n=<span class="built_in">normalize</span>(n);</span><br><span class="line">                <span class="comment">//灯光方向向量</span></span><br><span class="line">                fixed3 l=<span class="built_in">normalize</span>(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                fixed3 view=<span class="built_in">normalize</span>(WorldSpaceViewDir(v.vertex));</span><br><span class="line"></span><br><span class="line">                <span class="comment">//按照公式计算漫反射s</span></span><br><span class="line">                fixed ndotl =<span class="built_in">dot</span>(n,l);</span><br><span class="line">                fixed4 dif =_LightColor0*_MainColor*saturate(ndotl);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//镜面反射部分</span></span><br><span class="line">                float3 ref=<span class="built_in">reflect</span>(-l,n);</span><br><span class="line">                ref=<span class="built_in">normalize</span>(ref);</span><br><span class="line">                fixed rdotv=saturate(<span class="built_in">dot</span>(ref,view));</span><br><span class="line">                fixed4 spec=_LightColor0*_SpecularColor*<span class="built_in">pow</span>(rdotv,_Shininess);</span><br><span class="line"></span><br><span class="line">                o.color=unity_AmbientSky+dif+spec;</span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag (v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> i.color;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><img src="/2021/11/17/Unity-shader2/image-20211117204323435.png" alt="image-20211117204323435"></p>
<h2 id="逐像素光照-per-pixel"><a href="#逐像素光照-per-pixel" class="headerlink" title="逐像素光照 per-pixel"></a>逐像素光照 per-pixel</h2><p>​    据说phong被应用之后，高光部分会边缘不够圆滑。这是因为光照模型的计算一直是逐顶点光照。</p>
<p>​    逐顶点光照，就是在顶点着色器中计算光照颜色。GPU在对顶点进行光照计算后，得到颜色，然后通过顶点在多边形上所占的范围对像素颜色进行线性插值。细分较低（多边形数量少）的模型，就会棱角分明，高光也不理想。</p>
<p>​    那么逐像素光照per-pixel就是在像素着色器（也就是片段着色器）进行着色的。计算不再基于顶点，而是像素，计算量增大。</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            CGPROGRAM</span><br><span class="line">            ......</span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 normal:TEXCOORD0;</span><br><span class="line">                float4 vertex:TEXCOORD1;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            fixed4 _MainColor;</span><br><span class="line">            fixed4 _SpecularColor;</span><br><span class="line">            half _Shininess;</span><br><span class="line"></span><br><span class="line">            v2f vert (appdata_base v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos =UnityObjectToClipPos(v.vertex);  </span><br><span class="line">                o.normal =v.normal;</span><br><span class="line">                o.vertex =v.vertex;</span><br><span class="line">                <span class="keyword">return</span> o;   </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag (v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                float3 n=UnityObjectToWorldNormal(i.normal);</span><br><span class="line">                n=<span class="built_in">normalize</span>(n);</span><br><span class="line">                fixed3 l=<span class="built_in">normalize</span>(_WorldSpaceLightPos0.xyz);</span><br><span class="line">                fixed3 view=<span class="built_in">normalize</span>(WorldSpaceViewDir(v.vertex));</span><br><span class="line"></span><br><span class="line">                <span class="comment">//按照公式计算漫反射s</span></span><br><span class="line">                fixed ndotl =<span class="built_in">dot</span>(n,l);</span><br><span class="line">                fixed4 dif =_LightColor0*_MainColor*saturate(ndotl);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//镜面反射部分</span></span><br><span class="line">                float3 ref=<span class="built_in">reflect</span>(-l,n);</span><br><span class="line">                ref=<span class="built_in">normalize</span>(ref);</span><br><span class="line">                fixed rdotv=saturate(<span class="built_in">dot</span>(ref,view));</span><br><span class="line">                fixed4 spec=_LightColor0*_SpecularColor*<span class="built_in">pow</span>(rdotv,_Shininess);</span><br><span class="line">                <span class="comment">//return    </span></span><br><span class="line">                <span class="keyword">return</span> unity_AmbientSky+dif+spec;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="comment">//其实就是移过去了</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/11/17/Unity-shader2/image-20211118181116607.png" alt="per-vertex"></p>
<p><img src="/2021/11/17/Unity-shader2/image-20211118181228268.png" alt="per-pixel"></p>
<p>​    你能看出区别吗？（我不能）</p>
<hr>
<h2 id="Blinn-Phong光照模型"><a href="#Blinn-Phong光照模型" class="headerlink" title="Blinn-Phong光照模型"></a>Blinn-Phong光照模型</h2><p>​    与phong相比，将计算镜面反射光线的r（即入射光线的反射光线）替换成了入射光线和摄像机视角v的角平分线方向h。<br>$$<br>h=normalize(l,v)<br>$$</p>
<p>$$<br>C_Specular=(C_light·M_specular)saturate(v·h)^Mshininess<br>$$</p>
<p>​    其优点在于，在摄像机和光源都离物体无限远的时候，h只取决于俩者方向，可被视为常量，减少计算量。而phong则要根据表面曲率逐个计算反射向量r，效率低。</p>
<p>​    但在查阅资料后发现，phong还有一个很大的问题:<img src="/2021/11/17/Unity-shader2/92f4f5f9b284a56a0ee6e7f7235fb985.png" alt="两种模型的效果图2，此处可以发现Phong模型的一个问题"></p>
<p>​    “第二张效果图中，我们可以发现Phong模型在一些情况下会导致显示效果不平滑。当反射光与视线的夹角大于90度时，由于在实际渲染时余弦值总是被限制在[0,1]，在这些地方上高光项没有任何贡献。当物体的反光度非常小时，高光半径就会非常大，在反射角与视线夹角为90度的区域附近就会出现很明显的断层现象。而由于半角向量与法线夹角总不大于90度，使用Blinn-Phong模型时断层现象不会发生。”<img src="/2021/11/17/Unity-shader2/6a29e48cee2d8eee77eeddb6b49f22aa-16372315719662.png" alt="效果图2的断层问题的产生原因示意图"></p>
<hr>
<h2 id="灯光阴影"><a href="#灯光阴影" class="headerlink" title="灯光阴影"></a>灯光阴影</h2><h3 id="渲染路径"><a href="#渲染路径" class="headerlink" title="渲染路径"></a>渲染路径</h3><h4 id="延迟着色渲染"><a href="#延迟着色渲染" class="headerlink" title="延迟着色渲染"></a>延迟着色渲染</h4><p>​    较强，需要设备支持，所有灯光可以逐像素渲染</p>
<h4 id="前向渲染"><a href="#前向渲染" class="headerlink" title="前向渲染"></a>前向渲染</h4><p>​    传统的渲染方式，支持所有unity图形，兼容性好。</p>
<p>​    默认4个逐像素灯光（渲染模式为Important，如果不够4个，比较亮的灯光会逐像素渲染），4个逐顶点灯光，其他的都是SH渲染（Spherical Harmonics 球谐 球面调和）。SH渲染很快，只消耗较少cpu，几乎无gpu。</p>
<h3 id="Pass里面的标签"><a href="#Pass里面的标签" class="headerlink" title="Pass里面的标签"></a>Pass里面的标签</h3><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Pass&#123;</span><br><span class="line">	Tags&#123;</span><br><span class="line">	&quot;LightMode&quot; = &quot;ForwardBase&quot; </span><br><span class="line">        &quot;PassFlags&quot; = &quot;xxxx&quot;</span><br><span class="line">	<span class="comment">//定义该Pass在Unity的流水线中的角色 (只有定义它才能获取到一些Unity内置的光照变量如_LightColor0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="内置的-multi-compile-多重编译指令"><a href="#内置的-multi-compile-多重编译指令" class="headerlink" title="内置的 multi_compile 多重编译指令"></a>内置的 multi_compile 多重编译指令</h3><p>​    #pragma multi_compile_fwdbase是unity内置的用于前向渲染的关键字快捷方式，它包含了前向渲染光照计算需要的大多数关键字，因此会被shader带来很多的变体。</p>
<h3 id="实现阴影-投影-效果"><a href="#实现阴影-投影-效果" class="headerlink" title="实现阴影(投影)效果"></a>实现阴影(投影)效果</h3><p>​    案例使用Lambert光照模型，不计算镜面反射。按照前向渲染的光照标准进行，分为俩个pass。</p>
<p>​    基础pass用于渲染平行光和逐顶点或者SH灯光，并为平行光产生阴影投影。</p>
<p>​    额外pass用于逐像素，也为逐像素灯光产生阴影投影。</p>
<p><img src="/2021/11/17/Unity-shader2/image-20211118193048793.png" alt="image-20211118193048793"></p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Hidden/<span class="number">5</span>_LambertWithShadow&quot;</span><br><span class="line">&#123;</span><br><span class="line">    Properties</span><br><span class="line">    &#123;</span><br><span class="line">        _MainColor (&quot;Main Color&quot;, Color) = (<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    SubShader</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// -------- 基础Pass 为主要平行光产生投影 --------</span></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 添加Pass标签</span></span><br><span class="line">            Tags&#123;&quot;LightMode&quot; = &quot;ForwardBase&quot;&#125;</span><br><span class="line"></span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#pragma vertex vert</span></span><br><span class="line">            <span class="meta">#pragma fragment frag</span></span><br><span class="line">            <span class="meta">#pragma multi_compile_fwdbase</span></span><br><span class="line">            <span class="meta">#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line">            <span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line">            <span class="meta">#include &quot;AutoLight.cginc&quot;</span></span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 normal : TEXCOORD0;</span><br><span class="line">                float4 vertex : TEXCOORD1;</span><br><span class="line">                SHADOW_COORDS(<span class="number">2</span>) <span class="comment">// 使用预定义宏保存阴影坐标</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            fixed4 _MainColor;</span><br><span class="line"></span><br><span class="line">            v2f vert (appdata_base v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.normal = v.normal;</span><br><span class="line">                o.vertex = v.vertex;</span><br><span class="line">                TRANSFER_SHADOW(o) <span class="comment">// 使用预定义宏变换阴影坐标</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag (v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 准备变量</span></span><br><span class="line">                float3 n = UnityObjectToWorldNormal(i.normal);</span><br><span class="line">                n = <span class="built_in">normalize</span>(n);</span><br><span class="line">                float3 l = WorldSpaceLightDir(i.vertex);</span><br><span class="line">                l = <span class="built_in">normalize</span>(l);</span><br><span class="line">                float4 worldPos = mul(unity_ObjectToWorld, i.vertex);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Lambert光照</span></span><br><span class="line">                fixed ndotl = saturate(<span class="built_in">dot</span>(n, l));</span><br><span class="line">                fixed4 color = _LightColor0 * _MainColor * ndotl;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 加上4个点光源的光照</span></span><br><span class="line">                color.rgb += Shade4PointLights(</span><br><span class="line">                unity_4LightPosX0, unity_4LightPosY0, unity_4LightPosZ0,</span><br><span class="line">                unity_LightColor[<span class="number">0</span>].rgb, unity_LightColor[<span class="number">1</span>].rgb,</span><br><span class="line">                unity_LightColor[<span class="number">2</span>].rgb, unity_LightColor[<span class="number">3</span>].rgb,</span><br><span class="line">                unity_4LightAtten0, worldPos.rgb, n) * _MainColor;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 加上环境光照</span></span><br><span class="line">                color += unity_AmbientSky;		<span class="comment">//区别仅仅在这？</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 使用预定义宏计算阴影系数</span></span><br><span class="line">                UNITY_LIGHT_ATTENUATION(shadowmask, i, worldPos.rgb)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 阴影合成</span></span><br><span class="line">                color.rgb *= shadowmask;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> color;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// -------- 额外的Pass 为其他逐像素的灯光产生投影 --------</span></span><br><span class="line">        Pass</span><br><span class="line">        &#123;</span><br><span class="line">            Tags&#123;&quot;LightMode&quot; = &quot;ForwardAdd&quot;&#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用相加混合，使绘制的图像与上一个Pass完全混合</span></span><br><span class="line">            Blend One One</span><br><span class="line"></span><br><span class="line">            CGPROGRAM</span><br><span class="line">            <span class="meta">#pragma vertex vert</span></span><br><span class="line">            <span class="meta">#pragma fragment frag</span></span><br><span class="line">            <span class="meta">#pragma multi_compile_fwdadd_fullshadows</span></span><br><span class="line">            <span class="meta">#include &quot;UnityCG.cginc&quot;</span></span><br><span class="line">            <span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line">            <span class="meta">#include &quot;AutoLight.cginc&quot;</span></span><br><span class="line"></span><br><span class="line">            struct v2f</span><br><span class="line">            &#123;</span><br><span class="line">                float4 pos : SV_POSITION;</span><br><span class="line">                float3 normal : TEXCOORD0;</span><br><span class="line">                float4 vertex : TEXCOORD1;</span><br><span class="line">                SHADOW_COORDS(<span class="number">2</span>) <span class="comment">// 使用预定义宏保存阴影坐标</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            fixed4 _MainColor;</span><br><span class="line"></span><br><span class="line">            v2f vert (appdata_base v)</span><br><span class="line">            &#123;</span><br><span class="line">                v2f o;</span><br><span class="line">                o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">                o.normal = v.normal;</span><br><span class="line">                o.vertex = v.vertex;</span><br><span class="line">                TRANSFER_SHADOW(o) <span class="comment">// 使用预定义宏变换阴影坐标</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> o;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            fixed4 frag (v2f i) : SV_Target</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 准备变量</span></span><br><span class="line">                float3 n = UnityObjectToWorldNormal(i.normal);</span><br><span class="line">                n = <span class="built_in">normalize</span>(n);</span><br><span class="line">                float3 l = WorldSpaceLightDir(i.vertex);</span><br><span class="line">                l = <span class="built_in">normalize</span>(l);</span><br><span class="line">                float4 worldPos = mul(unity_ObjectToWorld, i.vertex);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// Lambert光照</span></span><br><span class="line">                fixed ndotl = saturate(<span class="built_in">dot</span>(n, l));</span><br><span class="line">                fixed4 color = _LightColor0 * _MainColor * ndotl;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 加上4个点光源的光照</span></span><br><span class="line">                color.rgb += Shade4PointLights(</span><br><span class="line">                unity_4LightPosX0, unity_4LightPosY0, unity_4LightPosZ0,</span><br><span class="line">                unity_LightColor[<span class="number">0</span>].rgb, unity_LightColor[<span class="number">1</span>].rgb,</span><br><span class="line">                unity_LightColor[<span class="number">2</span>].rgb, unity_LightColor[<span class="number">3</span>].rgb,</span><br><span class="line">                unity_4LightAtten0, worldPos.rgb, n) * _MainColor;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 使用预定义宏计算阴影系数</span></span><br><span class="line">                UNITY_LIGHT_ATTENUATION(shadowmask, i, worldPos.rgb)</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 阴影合成</span></span><br><span class="line">                color.rgb *= shadowmask;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> color;</span><br><span class="line">            &#125;</span><br><span class="line">            ENDCG</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    FallBack &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有一说一，没有很看懂…………</p>
<h1 id="带纹理的shader！（转载部分）"><a href="#带纹理的shader！（转载部分）" class="headerlink" title="带纹理的shader！（转载部分）"></a>带纹理的shader！（转载部分）</h1><h2 id="1-使用Blinn-Phong光照模型的单张纹理Shader："><a href="#1-使用Blinn-Phong光照模型的单张纹理Shader：" class="headerlink" title="1.使用Blinn-Phong光照模型的单张纹理Shader："></a>1.使用Blinn-Phong光照模型的单张纹理Shader：</h2><figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Custom/SingleTexture&quot; &#123;</span><br><span class="line">	Properties &#123;</span><br><span class="line">		_Color (&quot;Color&quot;, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">		_MainTex (&quot;Albedo&quot;, <span class="number">2</span>D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">		_Gloss (&quot;Gloss&quot;, Range(<span class="number">8.0</span>,<span class="number">256</span>)) = <span class="number">20</span></span><br><span class="line">		_Specular (&quot;Specular&quot;, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	SubShader &#123;</span><br><span class="line">		Pass&#123;</span><br><span class="line">			Tags&#123;&quot;RenderType&quot;=&quot;ForwardBase&quot;&#125;</span><br><span class="line">			CGPROGRAM</span><br><span class="line">			<span class="meta">#pragma vertex vert</span></span><br><span class="line">			<span class="meta">#pragma fragment frag</span></span><br><span class="line"> </span><br><span class="line">			<span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line"> </span><br><span class="line">			fixed4 _Color;</span><br><span class="line">			<span class="type">sampler2D</span> _MainTex;</span><br><span class="line">			float4 _MainTex_ST;</span><br><span class="line">			<span class="type">float</span> _Gloss;</span><br><span class="line">			fixed4 _Specular;</span><br><span class="line"> </span><br><span class="line">			struct a2v&#123;</span><br><span class="line">				float4 vertex:POSITION;</span><br><span class="line">				float3 normal:NORMAL;</span><br><span class="line">				float4 texcoord:TEXCOORD0;</span><br><span class="line">			&#125;;</span><br><span class="line"> </span><br><span class="line">			struct v2f&#123;</span><br><span class="line">				float4 pos:SV_POSITION;</span><br><span class="line">				float3 worldNormal:TEXCOORD0;</span><br><span class="line">				float3 worldPos:TEXCOORD1;</span><br><span class="line">				float2 uv:TEXCOORD2;</span><br><span class="line">			&#125;;</span><br><span class="line"> </span><br><span class="line">			v2f vert(a2v v)&#123;</span><br><span class="line">				v2f o;</span><br><span class="line">				o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">				o.worldNormal = <span class="built_in">normalize</span>(mul(v.normal, (float3x3)unity_WorldToObject));</span><br><span class="line">				float4 worldPos = mul(unity_ObjectToWorld, v.vertex);</span><br><span class="line">				o.worldPos = worldPos.xyz;</span><br><span class="line">				o.uv = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;</span><br><span class="line">				<span class="keyword">return</span> o;</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">			fixed4 frag(v2f i):SV_TARGET&#123;</span><br><span class="line">				float3 worldNormal = i.worldNormal;</span><br><span class="line">				float3 worldPos = i.worldPos;</span><br><span class="line">				float3 worldLight = <span class="built_in">normalize</span>(UnityWorldSpaceLightDir(worldPos));</span><br><span class="line"> </span><br><span class="line">				float3 albedo = tex2D(_MainTex,i.uv).rgb * _Color.rgb;</span><br><span class="line"> </span><br><span class="line">				fixed3 diffuse = _LightColor0.rgb * albedo * saturate(<span class="built_in">dot</span>(worldNormal, worldLight));</span><br><span class="line"> </span><br><span class="line">				float3 viewDir = <span class="built_in">normalize</span>(UnityWorldSpaceViewDir(worldPos));</span><br><span class="line">				float3 h = <span class="built_in">normalize</span>(viewDir + worldLight);</span><br><span class="line"> </span><br><span class="line">				fixed3 specular = _LightColor0.rgb * _Specular.rgb * <span class="built_in">pow</span>(saturate(<span class="built_in">dot</span>(h,worldNormal)),_Gloss);</span><br><span class="line"> </span><br><span class="line">				fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT * albedo;</span><br><span class="line"> </span><br><span class="line">				<span class="keyword">return</span> fixed4(ambient + diffuse + specular, <span class="number">1</span>);</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	FallBack &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    在属性声明中，我们添加了一个_MainTexture变量，它是2D类型的，在Inspecutor面板中，它可以选择一张贴图。</p>
<p>​    在a2v中我们声明了texcoord，通过它与_MainTexture中的值来计算v2f中的uv纹理坐标值，通过这个uv坐标值获取纹理信息。</p>
<p>​    我们不仅声明了sampler2D类型的_MainTexture，还声明了一个float4类型的_MainTexture_ST，ST是scale缩放与translation平移的缩写，可以通过它获得纹理的缩放和平移值，其中_MainTexture_ST.xy存储的是缩放值，_MainTexture_ST.zw存储的是偏移值。</p>
<p>​    在vert函数中，我们计算uv纹理坐标值并通过v2f传递给frag函数，在frag函数中，通过tex2D(_MainTexture, uv)获得纹理信息。计算得albedo=Color * texInfo，然后计算diffuse的等式中的材质属性用albedo来计算，环境光计算也要用ambient=UNITY_AMBIENT * albedo，高光计算不使用albedo。</p>
<p>​    这样我们就完成了最简单的纹理Shader</p>
<h2 id="2-应用法线纹理的Shader："><a href="#2-应用法线纹理的Shader：" class="headerlink" title="2.应用法线纹理的Shader："></a>2.应用法线纹理的Shader：</h2><p>​    法线纹理用于存储表面法线信息，一般一张法线纹理对应着一张普通纹理。我们也可以这样理解，法线纹理中保存的法线 就是用于替换原来  光照模型计算过程中  使用的worldNormal（及其他空间的normal）。由于法线方向分量范围为[-1，1]，而像素分量范围为[0，1]，所以我们要做一个映射来在纹理中存储法线分量：</p>
<p>​    pixel = （normal+1）/ 2</p>
<p>​    normal = pixel X 2 - 1</p>
<p>​    法线纹理中存储的法线方向，是保存在切线空间中的。这里来解释一下切线空间：切线空间中x轴为该点的切线方向，z轴为该点的法线方向，y轴为x，z轴叉乘得到的方向轴。如果法线纹理中的法线与该点原来的法线一致，则为(0，0，1)，在纹理中表现为蓝色，如果不一致则会表现为其他颜色，这样就在法线纹理中表示出了法线的特征。</p>
<p>​    所以我们的计算可以分为两种：</p>
<p>​    （1）在切线空间计算，需要到切线空间的变换矩阵</p>
<p>​    （2）在世界空间计算，需要切线空间到世界空间的变换矩阵</p>
<p>切线空间计算的Shader如下：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Custom/NormalMap_1&quot; &#123;</span><br><span class="line">	Properties &#123;</span><br><span class="line">		_Color(&quot;Color&quot;,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">		_Specular(&quot;Specular&quot;,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">		_Gloss(&quot;Gloss&quot;,Range(<span class="number">8.0</span>,<span class="number">256</span>))=<span class="number">20</span></span><br><span class="line">		_MainTex(&quot;Texture&quot;,<span class="number">2</span>D)=&quot;white&quot;&#123;&#125;</span><br><span class="line">		_NormalMap(&quot;NormalMap&quot;,<span class="number">2</span>D)=&quot;white&quot;&#123;&#125;</span><br><span class="line">		_NormalScale(&quot;NormalScale&quot;,Float) = <span class="number">1.0</span></span><br><span class="line">	&#125;</span><br><span class="line">	SubShader &#123;</span><br><span class="line">		Pass&#123;</span><br><span class="line">			Tags&#123;&quot;RenderType&quot;=&quot;ForwardBase&quot;&#125;</span><br><span class="line">			CGPROGRAM</span><br><span class="line">			<span class="meta">#pragma vertex vert</span></span><br><span class="line">			<span class="meta">#pragma fragment frag</span></span><br><span class="line">			<span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line"> </span><br><span class="line">			fixed4 _Color;</span><br><span class="line">			fixed4 _Specular;</span><br><span class="line">			<span class="type">float</span> _Gloss;</span><br><span class="line">			<span class="type">sampler2D</span> _MainTex;</span><br><span class="line">			float4 _MainTex_ST;</span><br><span class="line">			<span class="type">sampler2D</span> _NormalMap;</span><br><span class="line">			float4 _NormalMap_ST;</span><br><span class="line">			<span class="type">float</span> _NormalScale;</span><br><span class="line"> </span><br><span class="line">			struct a2v&#123;</span><br><span class="line">				float4 vertex:POSITION;</span><br><span class="line">				float3 normal:NORMAL;</span><br><span class="line">				float4 tangent:TANGENT;</span><br><span class="line">				float4 texcoord:TEXCOORD0;</span><br><span class="line">			&#125;;</span><br><span class="line"> </span><br><span class="line">			struct v2f&#123;</span><br><span class="line">				float4 pos:SV_POSITION;</span><br><span class="line">				float4 uv:TEXCOORD0;</span><br><span class="line">				float3 lightDir:TEXCOORD1;</span><br><span class="line">				float3 viewDir:TEXCOORD2;</span><br><span class="line">			&#125;;</span><br><span class="line"> </span><br><span class="line">			v2f vert(a2v v)&#123;</span><br><span class="line">				v2f o;</span><br><span class="line">				o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">				o.uv.xy = _MainTex_ST.xy * v.texcoord.xy + _MainTex_ST.zw;</span><br><span class="line">				o.uv.zw = _NormalMap_ST.xy * v.texcoord.xy + _NormalMap_ST.zw;</span><br><span class="line"> </span><br><span class="line">				float3 binormal = <span class="built_in">cross</span>(<span class="built_in">normalize</span>(v.normal), <span class="built_in">normalize</span>(v.tangent.xyz)) * v.tangent.w;</span><br><span class="line">				float3x3 rotation = float3x3(<span class="built_in">normalize</span>(v.tangent.xyz), <span class="built_in">normalize</span>(binormal), <span class="built_in">normalize</span>(v.normal));</span><br><span class="line">				o.lightDir = <span class="built_in">normalize</span>(mul(rotation, ObjSpaceLightDir(v.vertex)).xyz);</span><br><span class="line">				o.viewDir = <span class="built_in">normalize</span>(mul(rotation, ObjSpaceViewDir(v.vertex)).xyz);</span><br><span class="line"> </span><br><span class="line">				<span class="keyword">return</span> o;</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">			fixed4 frag(v2f i):SV_TARGET&#123;</span><br><span class="line">				fixed3 tangentLightDir = i.lightDir;</span><br><span class="line">				fixed3 tangentViewDir = i.viewDir;</span><br><span class="line"> </span><br><span class="line">				fixed4 packedNormal = tex2D(_NormalMap, i.uv.zw);</span><br><span class="line">				fixed3 tangentNormal;</span><br><span class="line">				tangentNormal.xy = (packedNormal.xy * <span class="number">2</span> - <span class="number">1</span>) * _NormalScale;</span><br><span class="line">				tangentNormal.z = <span class="built_in">sqrt</span>(<span class="number">1.0</span>-saturate(<span class="built_in">dot</span>(tangentNormal.xy,tangentNormal.xy)));</span><br><span class="line"> </span><br><span class="line">				fixed3 albedo = tex2D(_MainTex, i.uv.xy).rgb * _Color.rgb;</span><br><span class="line"> </span><br><span class="line">				fixed3 diffuse = _LightColor0.rgb * albedo * saturate(<span class="built_in">dot</span>(tangentLightDir, tangentNormal));</span><br><span class="line"> </span><br><span class="line">				fixed3 h = <span class="built_in">normalize</span>(tangentLightDir + tangentViewDir);</span><br><span class="line">				fixed3 specular = _LightColor0.rgb * _Specular.rgb * <span class="built_in">pow</span>(saturate(<span class="built_in">dot</span>(h, tangentNormal)),_Gloss);</span><br><span class="line"> </span><br><span class="line">				fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.xyz * albedo;</span><br><span class="line"> </span><br><span class="line">				<span class="keyword">return</span> fixed4(diffuse+specular+ambient, <span class="number">1.0</span>);</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	FallBack &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    在vert函数中的rotation就是变换到切线空间的矩阵，它是切线空间x轴，y轴，z轴按顺序排列得到的矩阵。frag中的packedNormal是法线纹理中的像素信息(在[0，1]中)，tangentNormal是变换后的法线信息(在变换到[-1，1]中后乘以Scale)</p>
<p>在世界空间中的计算：</p>
<figure class="highlight glsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">Shader &quot;Custom/NormalMap_2&quot; &#123;</span><br><span class="line">	Properties &#123;</span><br><span class="line">		_Color (&quot;Color&quot;, Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">		_Specular(&quot;Specular&quot;,Color) = (<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line">		_Gloss(&quot;Gloss&quot;,Range(<span class="number">8.0</span>,<span class="number">256</span>))=<span class="number">20</span></span><br><span class="line">		_MainTex (&quot;MainTex&quot;, <span class="number">2</span>D) = &quot;white&quot; &#123;&#125;</span><br><span class="line">		_NormalMap(&quot;NormalMap&quot;,<span class="number">2</span>D)= &quot;white&quot;&#123;&#125;</span><br><span class="line">		_NormalScale(&quot;NormalScale&quot;,Float) = <span class="number">1.0</span></span><br><span class="line"> </span><br><span class="line">	&#125;</span><br><span class="line">	SubShader &#123;</span><br><span class="line">		Pass&#123;</span><br><span class="line">			Tags&#123;&quot;LightMode&quot;=&quot;ForwardBase&quot;&#125;</span><br><span class="line">			CGPROGRAM</span><br><span class="line">			<span class="meta">#pragma vertex vert</span></span><br><span class="line">			<span class="meta">#pragma fragment frag</span></span><br><span class="line">			<span class="meta">#include &quot;Lighting.cginc&quot;</span></span><br><span class="line"> </span><br><span class="line">			fixed4 _Color;</span><br><span class="line">			fixed4 _Specular;</span><br><span class="line">			<span class="type">float</span> _Gloss;</span><br><span class="line">			<span class="type">sampler2D</span> _MainTex;</span><br><span class="line">			float4 _MainTex_ST;</span><br><span class="line">			<span class="type">sampler2D</span> _NormalMap;</span><br><span class="line">			float4 _NormalMap_ST;</span><br><span class="line">			<span class="type">float</span> _NormalScale;</span><br><span class="line"> </span><br><span class="line">			struct a2v&#123;</span><br><span class="line">				float4 vertex:POSITION;</span><br><span class="line">				float3 normal:NORMAL;</span><br><span class="line">				float2 texcoord:TEXCOORD0;</span><br><span class="line">				float4 tangent:TANGENT;</span><br><span class="line">			&#125;;</span><br><span class="line"> </span><br><span class="line">			struct v2f&#123;</span><br><span class="line">				float4 pos:SV_POSITION;</span><br><span class="line">				float3 worldPos:TEXCOORD0;</span><br><span class="line">				float3 T2W_0:TEXCOORD2;</span><br><span class="line">				float3 T2W_1:TEXCOORD3;</span><br><span class="line">				float3 T2W_2:TEXCOORD4;</span><br><span class="line">				float4 uv:TEXCOORD1;</span><br><span class="line">			&#125;;</span><br><span class="line"> </span><br><span class="line">			v2f vert(a2v v)&#123;</span><br><span class="line">				v2f o;</span><br><span class="line">				fixed3 worldPos = mul(unity_ObjectToWorld, v.vertex).xyz;</span><br><span class="line">				fixed3 worldNormal = <span class="built_in">normalize</span>(mul(v.normal, (float3x3)unity_WorldToObject));</span><br><span class="line">				fixed3 worldTangent = <span class="built_in">normalize</span>(mul(unity_ObjectToWorld, v.tangent).xyz);</span><br><span class="line">				fixed3 binormal = <span class="built_in">normalize</span>(<span class="built_in">cross</span>(worldNormal, worldTangent) * v.tangent.w);</span><br><span class="line"> </span><br><span class="line">				o.pos = UnityObjectToClipPos(v.vertex);</span><br><span class="line">				o.worldPos = worldPos;</span><br><span class="line">				o.T2W_0 = float3(worldTangent.x, binormal.x, worldNormal.x);</span><br><span class="line">				o.T2W_1 = float3(worldTangent.y, binormal.y, worldNormal.y);</span><br><span class="line">				o.T2W_2 = float3(worldTangent.z, binormal.z, worldNormal.z);</span><br><span class="line">				o.uv.xy = _MainTex_ST.xy * v.texcoord.xy + _MainTex_ST.zw;</span><br><span class="line">				o.uv.zw = _NormalMap_ST.xy * v.texcoord.xy + _NormalMap_ST.zw;</span><br><span class="line"> </span><br><span class="line">				<span class="keyword">return</span> o;</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">			fixed4 frag(v2f i):SV_TARGET&#123;</span><br><span class="line">				float3 worldLightDir = <span class="built_in">normalize</span>(UnityWorldSpaceLightDir(i.worldPos));</span><br><span class="line">				float3 worldViewDir = <span class="built_in">normalize</span>(UnityWorldSpaceViewDir(i.worldPos));</span><br><span class="line"> </span><br><span class="line">				float3 packedNormal = tex2D(_NormalMap, i.uv.zw).xyz;</span><br><span class="line">				float3 bump;</span><br><span class="line">				bump.xy = (packedNormal.xy * <span class="number">2</span> - <span class="number">1</span>) * _NormalScale;</span><br><span class="line">				bump.z = <span class="built_in">sqrt</span>(<span class="number">1.0</span> - saturate(<span class="built_in">dot</span>(bump.xy, bump.xy)));</span><br><span class="line"> </span><br><span class="line">				bump = <span class="built_in">normalize</span>(half3(<span class="built_in">dot</span>(i.T2W_0, bump), <span class="built_in">dot</span>(i.T2W_1,bump), <span class="built_in">dot</span>(i.T2W_2,bump)));</span><br><span class="line"> </span><br><span class="line">				fixed3 albedo = tex2D(_MainTex, i.uv.xy).rgb * _Color.rgb;</span><br><span class="line"> </span><br><span class="line">				fixed3 diffuse = _LightColor0.rgb * albedo * saturate(<span class="built_in">dot</span>(worldLightDir, bump));</span><br><span class="line">				fixed3 ambient = albedo * UNITY_LIGHTMODEL_AMBIENT.rgb;</span><br><span class="line"> </span><br><span class="line">				fixed3 h = <span class="built_in">normalize</span>(worldLightDir + worldViewDir);</span><br><span class="line">				fixed3 specular = _LightColor0.rgb * _Specular.rgb * <span class="built_in">pow</span>(saturate(<span class="built_in">dot</span>(h,bump)),_Gloss);</span><br><span class="line"> </span><br><span class="line">				<span class="keyword">return</span> fixed4(diffuse + ambient + specular, <span class="number">1.0</span>);</span><br><span class="line">			&#125;</span><br><span class="line"> </span><br><span class="line">			ENDCG</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	FallBack &quot;Diffuse&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>[TOC]</p>
<p>Thanks：</p>
<p><a target="_blank" rel="noopener" href="https://www.pianshen.com/article/18651304807/">https://www.pianshen.com/article/18651304807/</a></p>
<p>【GDC2008】Stupid Spherical Harmonics (SH) Tricks:<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a379b4c6d346">https://www.jianshu.com/p/a379b4c6d346</a></p>
<p>聊一下球谐函数（Spherical Harmonics）计算光照:<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/34059900">https://zhuanlan.zhihu.com/p/34059900</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sifenkesi/p/9942272.html">https://www.cnblogs.com/sifenkesi/p/9942272.html</a></p>
<p>特别感谢：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37394426/article/details/86659283?spm=1001.2014.3001.5502">https://blog.csdn.net/qq_37394426/article/details/86659283?spm=1001.2014.3001.5502</a></p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Unity/" rel="tag"># Unity</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/11/16/Unity-shader/" rel="next" title="Unity_shader1_简介">
                <i class="fa fa-chevron-left"></i> Unity_shader1_简介
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/11/18/Unity-shader3/" rel="prev" title="Unity_shader3_表面着色器">
                Unity_shader3_表面着色器 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/head.jpg"
                alt="" />
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Zhairest" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://music.163.com/#/user/home?id=70879973" target="_blank" title="CloudMusic">
                      
                        <i class="fa fa-fw fa-cloud"></i>CloudMusic</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.baidu.com/" title="百度" target="_blank">百度</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#shader%E4%B8%AD%E7%9A%84%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.</span> <span class="nav-text">shader中的光照模型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Lambert%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.1.</span> <span class="nav-text">Lambert光照模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%82%A3%E5%A6%82%E4%BD%95%E5%9C%A8shader%E9%87%8C%E8%8E%B7%E5%BE%97%E7%81%AF%E5%85%89%E5%91%A2"><span class="nav-number">1.1.1.</span> <span class="nav-text">那如何在shader里获得灯光呢</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Half-Lambert%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.2.</span> <span class="nav-text">Half-Lambert光照模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Phong%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.3.</span> <span class="nav-text">Phong光照模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%82%A3%E5%A6%82%E4%BD%95%E5%9C%A8shader%E9%87%8C%E8%8E%B7%E5%BE%97%E7%8E%AF%E5%A2%83%E5%85%89%E5%91%A2"><span class="nav-number">1.3.1.</span> <span class="nav-text">那如何在shader里获得环境光呢</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%90%E5%83%8F%E7%B4%A0%E5%85%89%E7%85%A7-per-pixel"><span class="nav-number">1.4.</span> <span class="nav-text">逐像素光照 per-pixel</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Blinn-Phong%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="nav-number">1.5.</span> <span class="nav-text">Blinn-Phong光照模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%81%AF%E5%85%89%E9%98%B4%E5%BD%B1"><span class="nav-number">1.6.</span> <span class="nav-text">灯光阴影</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B8%B2%E6%9F%93%E8%B7%AF%E5%BE%84"><span class="nav-number">1.6.1.</span> <span class="nav-text">渲染路径</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%B6%E8%BF%9F%E7%9D%80%E8%89%B2%E6%B8%B2%E6%9F%93"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">延迟着色渲染</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%89%8D%E5%90%91%E6%B8%B2%E6%9F%93"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">前向渲染</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pass%E9%87%8C%E9%9D%A2%E7%9A%84%E6%A0%87%E7%AD%BE"><span class="nav-number">1.6.2.</span> <span class="nav-text">Pass里面的标签</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E7%9A%84-multi-compile-%E5%A4%9A%E9%87%8D%E7%BC%96%E8%AF%91%E6%8C%87%E4%BB%A4"><span class="nav-number">1.6.3.</span> <span class="nav-text">内置的 multi_compile 多重编译指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E9%98%B4%E5%BD%B1-%E6%8A%95%E5%BD%B1-%E6%95%88%E6%9E%9C"><span class="nav-number">1.6.4.</span> <span class="nav-text">实现阴影(投影)效果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%A6%E7%BA%B9%E7%90%86%E7%9A%84shader%EF%BC%81%EF%BC%88%E8%BD%AC%E8%BD%BD%E9%83%A8%E5%88%86%EF%BC%89"><span class="nav-number">2.</span> <span class="nav-text">带纹理的shader！（转载部分）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E4%BD%BF%E7%94%A8Blinn-Phong%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%8D%95%E5%BC%A0%E7%BA%B9%E7%90%86Shader%EF%BC%9A"><span class="nav-number">2.1.</span> <span class="nav-text">1.使用Blinn-Phong光照模型的单张纹理Shader：</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E5%BA%94%E7%94%A8%E6%B3%95%E7%BA%BF%E7%BA%B9%E7%90%86%E7%9A%84Shader%EF%BC%9A"><span class="nav-number">2.2.</span> <span class="nav-text">2.应用法线纹理的Shader：</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhairest</span>

  
</div>









        <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  
  

  

  
  

  

  

  

</body>
</html>
